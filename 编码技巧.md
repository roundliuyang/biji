### 统一响应实体

```java
/**
 * 统一响应实体
 * <p>
 * <br/>
 * 格式如下
 *
 * <pre>
 * {
 *     "content": "自定义业务Response",
 *     "message": "操作成功",
 *     "state": 1,
 *     "uiMessage": "自定义消息，用于前端显示"
 * }
 * </pre>
 */
public class ResponseDTO<T> implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * 操作状态
     */
    private int state;

    /**
     * 状态附加消息
     */
    private String message;

    /**
     * 响应内容
     */
    private T content;
    
    public ResponseDTO() {
    }

    public ResponseDTO(int state, String message, T content) {
        this.state = state;
        this.message = message;
        this.content = content;
    }

    public static <T> ResponseDTO<T> response(ResultCode resultCode) {
        return response(resultCode, null);
    }

    public static <T> ResponseDTO<T> response(ResultCode resultCode, T content) {
        return response(resultCode.getState(), resultCode.getMessage(), content);
    }

    public static <T> ResponseDTO<T> response(int state, String message) {
        return response(state, message, null);
    }
    
    public static <T> ResponseDTO<T> ofError(String message) {
        return new ResponseDTO<T>(ResultCode.INTERNAL_ERROR.getState(), message, null);
    }
    
    public static <T> ResponseDTO<T> ofError(int state, String message) {
        return ofError(state, message, null);
    }

    public static <T> ResponseDTO<T> ofError(int state, String message, T content) {
        return new ResponseDTO<T>(state, message, content);
    }

    public static <T> ResponseDTO<T> response(int state, String message, T content) {
        ResponseDTO<T> responseDTO = new ResponseDTO<>();
        responseDTO.setState(state);
        responseDTO.setMessage(message);
        responseDTO.setContent(content);
        return responseDTO;
    }

    public static <T> ResponseDTO<T> success() {
        return response(1, "success", null);
    }
    
    public boolean isSuccess() {
        return this.state == 1;
    }
    
    public static <T> ResponseDTO<T> success(T content) {
        return response(1, "success", content);
    }

    public int getState() {
        return state;
    }

    public void setState(int state) {
        this.state = state;
    }

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public T getContent() {
        return content;
    }

    public void setContent(T content) {
        this.content = content;
    }

    @Override
    public String toString() {
        return "ResponseDTO{" +
                "state=" + state +
                ", message='" + message + '\'' +
                ", content=" + content +
                '}';
    }
}
```

状态码：

```java

/**
 * 状态码定义：
 * <br/>
 * <table border="1">
 * <tr>
 *    <th>状态码</th>
 *    <th>说明</th>
 * </tr>
 * <tr>
 *    <td>1</td>
 *    <td>访问成功</td>
 * </tr>
 * <tr>
 *    <td>10xx</td>
 *    <td>系统级的错误，例如1002表示服务器内部错误</td>
 * </tr>
 * <tr>
 *     <td>aabbxxx</td>
 *     <td>业务状态码，aa是模块代号，从20开始；bb是子模块代号，从00开始；xxx是具体的状态码</td>
 * </tr>
 * </table>
 */
public enum ResultCode {

    /**
     * 1, 操作成功
     */
    SUCCESS(1, "操作成功"),

    /**
     * 1002, 服务器内部错误
     */
    INTERNAL_ERROR(1002, "服务器内部错误"),

    /**
     * 1003, 非法的访问类型
     */
    INVALID_ACCESS(1003, "非法的访问"),

    /**
     * 1004, 身份认证失败
     */
    AUTH_FAILED(1004, "身份认证失败"),
    
    /**
     * 1005 alert统一错误相应
     */
    ALERT_ERROR(1005,"alert统一错误相应"),

    /**
     * 1006, 没有数据改变，请使用缓存
     */
    NO_DATA_CHANGE(1006, "没有数据改变，请使用缓存"),

    /**
     * 1007, 防护码失败
     */
    PROTECTCODE_ERROR(1007, "防护码失败"),

    /**
     * 1008, 参数错误
     */
    PARAM_ERROR(1008, "参数错误"),
    
    /**
     * 1009, 服务器开小差，请稍后再试
     */
    SERVER_ERROR(1009, "服务器开小差，请稍后再试"),
    
    /**
     * 1010, 请求频繁，请稍后再试
    */
    REPETITION_ERROR(1010, "请求频繁，请稍后再试"),

    /**
     * 1997, token错误
     */
    CSRF_CODE_ERROR(1997, "token错误"),
    /**
     * 303, 图形验证码错误
     */
    VERIFYCODE_IMAGE_ERROR(303, "图形验证码错误"),
	
    FLOW_SENTINEL_ERROR(508, "当前访问人数较多，请稍后重试");
	
    private int state;
    private String message;

    ResultCode(int state) {
        this(state, null);
    }

    ResultCode(int state, String message) {
        this.state = state;
        this.message = message;
    }

    public int getState() {
        return state;
    }

    public String getMessage() {
        return message;
    }

}
```

### 参数校验

#### **示例1**

**（如开发登录功能，我们需要校验前端传来的参数）**

```java
public HttpMessage loginLogin(String userName, String password){
    
    if(StringUtils.isEmpty(userName) || StringUtils.isEmpty(password)){
        
        return new HttpMessage<>(null, HttpConstants.HttpStatus.ERROR, "用户名或密码不能为空");
    }
    User user = userService.findByUserNameAndPwd(userName,password);

    if(null == user){
        
        return new HttpMessage<>(null, HttpConstants.HttpStatus.ERROR, "用户名或密码错误");

    }
}
```

这时，我们就可以将里面的if判断去掉，使用Preconditions类提供的方法去判断

```java
public HttpMessage loginLogin(String userName, String password){
    Preconditions.checkArgument(!(StringUtils.isEmpty(userName) || StringUtils.isEmpty(password)),"用户名或密码不能为空");
    
    User user = userService.findByUserNameAndPwd(userName,password);
    
    Preconditions.checkNotNull(user,"用户名或密码错误");
   
    return new HttpMessage<>(user, HttpConstants.HttpStatus.OK, "请求成功");

}
```

是不是看着简洁优雅多了，还可以捕捉异常及错误信息，一般可以写个统一异常类捕捉（可根据不同的异常类型去获取），我这边为了简单直接用try{}捕捉

```java
public HttpMessage loginLogin(String userName, String password){
    try {
        //失败时抛出的异常类型: IllegalArgumentException
        Preconditions.checkArgument(!(StringUtils.isEmpty(userName) || StringUtils.isEmpty(password)),"用户名或密码不能为空");
    } catch (IllegalArgumentException e) {
        //e.getMessage()获取到的就是：用户名和密码不能为空
        return new HttpMessage<>(null, HttpConstants.HttpStatus.ERROR, e.getMessage());
    }
    User user = userService.findByUserNameAndPwd(userName,password);
    try {
        //失败时抛出的异常类型：NullPointerException
        Preconditions.checkNotNull(user,"用户名或密码错误");
        return new HttpMessage<>(null, HttpConstants.HttpStatus.OK, "请求成功");
    } catch (NullPointerException e) {
        //e.getMessage()获取到的就是：用户名或密码错误
        return new HttpMessage<>(user, HttpConstants.HttpStatus.ERROR, e.getMessage());
    }
}
```

#### 示例2

```java
/**
     * 参数校验
     * 
     * @param xingeQueryDto
     * @throws IllegalArgumentException
     */
    private void checkXingeQueryParam(AppQueryReqDto xingeQueryDto) throws IllegalArgumentException {
        // 避免空指针异常
        Preconditions.checkArgument(!StringUtils.isEmpty(xingeQueryDto.getAccount()), "账号不能为空");
        Preconditions.checkArgument(null != xingeQueryDto.getCurrentPage(), "currentPage不能为空");
        Preconditions.checkArgument(null != xingeQueryDto.getPageSize(), "pageSize不能为空");
        //如果用户未传productCode,则默认为NYDDXJD,兼容点点不传productCode逻辑
        if (StringUtils.isBlank(xingeQueryDto.getProductCode())) {
            xingeQueryDto.setProductCode(ProductCodeEnum.NYDDXJD.getCode());
        }
    }
```



### 对外接口规范

例如：

```java
/**
 * 天火对外接口实现类
 */
public class MessageSendApiServiceImpl implements MessageSendApiService {
    @Override
    public BalefireMessageResDto sendMail(BaleFireMailDto mailDto) {

        try {
            // 首先，对接接口首先需要log打印入参
            log.info("sendMail req param:{}", mailDto);
            // 校验参数 ，参数不对 throws IllegalArgumentException，catch捕捉（catch捕捉之后，选择执行恢复，而不是throw新的异常），log日志打印日志信息。
            checkParams(mailDto);
        } catch (IllegalArgumentException e1) {
            log.warn("send mail params error", e1);
            return BalefireMessageResDto.fail(ResultCodeEnum.SEND_ERROR.getCode(), e1.getMessage());
        }
        JMailMessageDto jMailMessageDto = null;
        try {
            jMailMessageDto = BeanConverterUtils.baleFireMailDto2JMailMessageDto(mailDto);
        } catch (Exception e) {
          
            log.error("baleFireMailDto2JMailMessageDto error", e);
            return BalefireMessageResDto.fail(ResultCodeEnum.SEND_ERROR.getCode(), ResultCodeEnum.SEND_ERROR.getDesc());
        }
        try {
              // 捕捉异常
            String sendMailChannel = jedisUtil.getString(CommonConstants.SEND_MAIL_CHANNELCODE);
            if (CommonConstants.SEND_MAIL_CHANNELCODE_ZMAIL.equalsIgnoreCase(sendMailChannel)) {
                return sendZMailService.send(jMailMessageDto);
            } else {
                return sendJMailService.send(jMailMessageDto);
            }
        } catch (Exception e) {
            // 记录异常  e
            log.error("send mail error", e);
            return BalefireMessageResDto.fail(ResultCodeEnum.SEND_ERROR.getCode(), ResultCodeEnum.SEND_ERROR.getDesc());
        }
    }
    
     /**
     * 参数校验
     * 
     * @param mailDto
     * @throws IllegalArgumentException
     */
    private void checkParams(BaleFireMailDto mailDto) throws IllegalArgumentException {
        Preconditions.checkArgument(!StringUtils.isEmpty(mailDto.getTitle()), "邮件标题不能为空");
        Preconditions.checkArgument(!StringUtils.isEmpty(mailDto.getSenderName()), "发送方名称不能为空");
        Preconditions.checkArgument(!StringUtils.isEmpty(mailDto.getReceivers()), "接收方邮箱不能为空");
        Preconditions.checkArgument(!StringUtils.isEmpty(mailDto.getSendType()), "发送类型不能为空");
        Preconditions.checkArgument("1".equals(mailDto.getSendType()) || "2".equals(mailDto.getSendType()),
                "发送类型只能为1或2");
    }
    
    
     public BalefireMessageResDto sendSms(BaleFireSmsReqDto baleFireSmsRequestDto) {
        try {
            // 调用第三方的接口（如发送短信）时，调用前打印入参
            log.info("sendSms-init req={}", baleFireSmsRequestDto);
            BalefireMessageResDto res = sendSmsService.send(baleFireSmsRequestDto);
              // 调第三方的接口时，调用后打印返回值
            log.info("sendSms-finish res={}", res);
            return res;
        } catch (BaleFireBizException e) {
            log.warn("sendSms-biz-err,req={}", baleFireSmsRequestDto, e);
            return new BalefireMessageResDto(e.getResultCode(), e.getResultMsg(),
                    baleFireSmsRequestDto.getOutTradeNo());
        } catch (Exception e) {
            log.error("sendSms-err,req={}", baleFireSmsRequestDto, e);
            return new BalefireMessageResDto(ResultCodeEnum.SYSTEM_ERROR.getCode(),
                    ResultCodeEnum.SYSTEM_ERROR.getDesc(), baleFireSmsRequestDto.getOutTradeNo());
        }
    }      
}
```

